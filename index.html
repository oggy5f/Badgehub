<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Badgehub</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<style>
    body {
        background:#0a0a0a;
        color:white;
        font-family:Arial, sans-serif;
        padding:20px;
    }
    .container{
        max-width:420px;
        margin:auto;
        background:#111;
        padding:20px;
        border-radius:12px;
        border:1px solid #222;
    }
    input, button {
        width:100%;
        padding:12px;
        margin-top:12px;
        border-radius:8px;
        border:none;
    }
    input {
        background:#222;
        color:white;
        font-size:16px;
    }
    button {
        background:#3478f6;
        color:white;
        font-size:16px;
        cursor:pointer;
        font-weight:bold;
    }
    button:disabled {
        background:#444;
        cursor:not-allowed;
    }
    #badgePreview {
        margin-top:20px;
        background:#fff;
        padding:20px;
        border-radius:12px;
        text-align:center;
    }
</style>
</head>

<body>

<div class="container">

    <h2>Badgehub Daily & Weekly Badge</h2>

    <!-- USER NAME / FID -->
    <input id="nameInput" placeholder="Your Name / FID" />

    <!-- DAILY CLAIM -->
    <button id="claimBtn">Claim Today's Badge</button>

    <!-- ONCHAIN DAILY MINT -->
    <button id="mintDailyBtn">Mint Daily Badge Onchain</button>

    <!-- WEEKLY MINT BUTTON (hidden until streak 7) -->
    <button id="weeklyMintBtn" style="display:none; background:#e68a00;">
        ðŸŽ‰ Mint 1-Week Badge
    </button>

    <div id="badgePreview"></div>

    <p id="status" style="color:#66f; margin-top:15px;"></p>

</div>


<!-- Ethers -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.8.0/ethers.umd.min.js"></script>


<script>

// ------------------------
// CONFIG
// ------------------------

const CONFIG = {
    chainId: 84532,  // Base Sepolia
    contractAddress: "PASTE_YOUR_NEW_CA_HERE",
};

// ------------------------
// CONTRACT ABI (Paste Your ABI Here)
// ------------------------
const CONTRACT_ABI = PASTE_YOUR_ABI_HERE;


// ------------------------
// STATE
// ------------------------
let streak = 0;
let lastDailyMint = 0;


// ------------------------
// DAILY CLAIM HANDLER
// ------------------------
document.getElementById("claimBtn").onclick = () => {
    const today = new Date().toDateString();
    const saved = localStorage.getItem("lastClaim");

    if (saved === today) {
        alert("Already claimed today!");
        return;
    }

    streak++;
    localStorage.setItem("streak", streak);
    localStorage.setItem("lastClaim", today);

    updateWeeklyButton();
    updateBadgePreview();

    document.getElementById("status").innerText = "Daily badge claimed!";
};


// ------------------------
// UPDATE WEEKLY BUTTON
// ------------------------
function updateWeeklyButton() {
    const btn = document.getElementById("weeklyMintBtn");
    if (streak >= 7) btn.style.display = "block";
    else btn.style.display = "none";
}


// ------------------------
// BADGE SVG PREVIEW
// ------------------------
function updateBadgePreview() {
    const name = document.getElementById("nameInput").value || "User";

    document.getElementById("badgePreview").innerHTML = `
        <h3 style="color:black;">Daily Badge Preview</h3>
        <svg width="320" height="200" xmlns="http://www.w3.org/2000/svg">
            <rect width="100%" height="100%" fill="#2276f2"/>
            <text x="50%" y="30%" fill="white" font-size="22px" text-anchor="middle">${name}</text>
            <text x="50%" y="60%" fill="white" font-size="18px" text-anchor="middle">
                Daily Check-in â€¢ Streak: ${streak}
            </text>
        </svg>
    `;
}


// ------------------------
// ONCHAIN DAILY MINT
// ------------------------
document.getElementById("mintDailyBtn").onclick = async () => {
    try {
        if (!window.ethereum) return alert("Connect wallet!");

        const provider = new ethers.BrowserProvider(window.ethereum);
        const signer = await provider.getSigner();
        const contract = new ethers.Contract(CONFIG.contractAddress, CONTRACT_ABI, signer);

        const name = document.getElementById("nameInput").value || "User";

        const svg = `<svg width="300" height="200" xmlns="http://www.w3.org/2000/svg">
            <rect width="100%" height="100%" fill="#2276f2"/>
            <text x="50%" y="30%" fill="white" font-size="22px" text-anchor="middle">${name}</text>
            <text x="50%" y="60%" fill="white" font-size="18px" text-anchor="middle">
                Streak: ${streak}
            </text>
        </svg>`;

        const svg64 = btoa(svg);

        const tokenURI = `data:application/json;base64,${btoa(JSON.stringify({
            name: `${name} Daily Badge`,
            description: "Daily Check-in Badge",
            image: `data:image/svg+xml;base64,${svg64}`
        }))}`;

        const tx = await contract.mintBadge(
            await signer.getAddress(),
            name,
            "Daily Check-in",
            Math.floor(Date.now() / 1000),
            streak,
            tokenURI
        );

        document.getElementById("status").innerText = "Minting daily badgeâ€¦";
        await tx.wait();
        document.getElementById("status").innerText = "Daily badge minted!";

    } catch (e) {
        alert("Error: " + e.message);
    }
};


// ------------------------
// WEEKLY BADGE MINT
// ------------------------
document.getElementById("weeklyMintBtn").onclick = async () => {
    try {
        const name = document.getElementById("nameInput").value || "User";

        if (streak < 7) return alert("You need 7-day streak!");

        const provider = new ethers.BrowserProvider(window.ethereum);
        const signer = await provider.getSigner();
        const contract = new ethers.Contract(CONFIG.contractAddress, CONTRACT_ABI, signer);

        const svg = `<svg width="320" height="260" xmlns="http://www.w3.org/2000/svg">
            <rect width="100%" height="100%" fill="#f29e00"/>
            <text x="50%" y="35%" fill="black" font-size="26px" text-anchor="middle">${name}</text>
            <text x="50%" y="65%" fill="black" font-size="22px" text-anchor="middle">
                ðŸŽ‰ 1-Week Completed ðŸŽ‰
            </text>
        </svg>`;

        const svg64 = btoa(svg);

        const tokenURI = `data:application/json;base64,${btoa(JSON.stringify({
            name: `${name} 1-Week Badge`,
            description: "Weekly Completion Badge",
            image: `data:image/svg+xml;base64,${svg64}`
        }))}`;

        const tx = await contract.mintWeekBadge(
            await signer.getAddress(),
            name,
            1,
            Math.floor(Date.now()/1000),
            streak,
            tokenURI
        );

        document.getElementById("status").innerText = "Minting weekly badgeâ€¦";
        await tx.wait();

        alert("ðŸŽ‰ Weekly badge minted successfully!");

    } catch (err) {
        alert("Weekly mint failed: " + err.message);
    }
};

</script>

</body>
</html>
